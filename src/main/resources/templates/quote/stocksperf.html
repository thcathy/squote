<html ng-app="quote1" ng-controller="QuoteController">
<head>
	<title>quote</title>
	<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" /> 
	<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.min.js"></script>
	<style>
		td {
			padding: 2px;
			
			font-family: 'Lucida Grande', Verdana, Arial, Sans-Serif;
			font-size: 10px;
		}
				
		.2828 {			
			background-color: rgb(185, 213, 237); 
		}			
	</style>	
</head>
<body>	
	<table>	
		<tr>
			<td>Code</td>
			<td>Name</td>
			<td style="text-align: right;">Price</td>
			<td style="text-align: right;">1 year %</td>
			<td style="text-align: right;">2 year %</td>
			<td style="text-align: right;">3 year %</td>
			<td style="text-align: right;">PE</td>
			<td style="text-align: right;">Yield</td>
			<td style="text-align: right;">NAV</td>
			<td>Year Low - High</td>
			<td style="text-align: right;">Change</td>
		</tr>
		<tr ng-repeat="quote in quotes" ng-style="quote.stockCode === '2828' &amp;&amp; {'background-color': 'rgb(185, 213, 237)'}">
			<td>{{quote.stockCode}}</td>
			<td>{{quote.stockName}}</td>
			<td style="text-align: right;">{{quote.price}}</td>
			<td style="text-align: right;">{{quote.lastYearPercentage.toFixed(2)}}</td>
			<td style="text-align: right;">{{quote.last2YearPercentage.toFixed(2)}}</td>
			<td style="text-align: right;">{{quote.last3YearPercentage.toFixed(2)}}</td>
			<td style="text-align: right;">{{quote.pe}}</td>
			<td style="text-align: right;">{{quote.yield}}</td>
			<td style="text-align: right;">{{quote.nav}}</td>
			<td>{{quote.yearLow}} - {{quote.yearHigh}}</td>
			<td style="text-align: right;">{{quote.change}}</td>
		</tr>
	</table>
	<div ng-bind="status"></div>
	<script type="text/javascript">	
		var retry=0;
		var retryLimit=20;
		
		angular.module('quote1',[]).controller('QuoteController', ['$scope','$http', function($scope,$http) {
			$scope.status='Loading';
			$scope.poll=function poll() {
				retry++;
				if (retry > retryLimit) return;
							
				$scope.status=$scope.status + '...';
				$http({url: "liststocksperf"}).
					success(function(data, status, headers, config) {
						$scope.quotes=data;
						$scope.status='';
					}).
					error(function(data, status, headers, config) {
						poll();
					});
			};
			$scope.poll();
		}]);		
	</script>
	<footer th:include="fragments/layout :: footer"></footer>
</body>
</html>